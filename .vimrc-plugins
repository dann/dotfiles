" ============================================
" surround.vim
" ============================================
" gettextnize texts
let g:surround_103 = "loc('\r')"  " 103 = g
let g:surround_71 = "loc(\"\r\")" " 71 = G
nmap g' cs'g
nmap g" cs"G

" surround the word with characters you set
nmap s <Plug>Ysurround
nmap ss <Plug>Yssurround

" ============================================
" Ctags
" ============================================
nnoremap t  <Nop>
nnoremap tt  <C-]>
nnoremap tj  :<C-u>tag<CR>
nnoremap tk  :<C-u>pop<CR>
nnoremap tl  :<C-u>tags<CR>

noremap <c-[>  :pop<CR>

" search tags under current dir
set tags+=./tags;/

" use :tjump
nnoremap <C-]> g<C-]>
nnoremap g<C-]> <C-]>

" (Ctrl + [) for tag jump back
nmap <c-[>  :pop<CR>

"QuickFix list
nnoremap <C-q><C-n> :cnext<CR>
nnoremap <C-q>n :cnext<CR>
nnoremap <C-q><C-p> :cprevious<CR>
nnoremap <C-q>p :cprevious<CR>
" tag stack
" nnoremap <C-t><C-t> <C-t>
" nnoremap <C-t>t <C-t>
" nnoremap <C-t><C-n> :tnext<CR>
" nnoremap <C-t>n :tnext<CR>
" nnoremap <C-t><C-p> :tprevious<CR>
" nnoremap <C-t>p :tprevious<CR>

" ============================================
" Help
" ============================================
nnoremap <C-h>  :<C-u>help<Space>

" ============================================
" taglist.vim
" ============================================
nnoremap ,tl     : Tlist<CR>
nnoremap ,t<C-l> : Tlist<CR>
nmap <silent> ,tt :TlistToggle
nnoremap ,to     : TlistClose<CR>
nnoremap ,t<C-o> : TlistClose<CR>
let Tlist_Use_Horiz_Window=0
let Tlist_Use_Right_Window = 1 "display taglist window on the right
let Tlist_Compact_Format = 1
let Tlist_Exit_OnlyWindow = 1 "if taglist window is the only window left, exit vim
let Tlist_GainFocus_On_ToggleOpen = 1 "automatically switch to taglist window
"let Tlist_Close_On_Select = 1 "close taglist window once we selected something
"let Tlist_File_Fold_Auto_Close = 1
"let Tlist_Inc_Winwidth = 0
"let Tlist_Process_File_Always = 1
"let Tlist_Ctags_Cmd = /path/to/exuberant/ctags


" python
let g:pydiction_location = '~/.vim/dict/pydiction/complete-dict' 

" ============================================
" Grep.vim
" ============================================
let Grep_Skip_Dirs = '.svn'
let Grep_Skip_Files = '*.bak *~'

" Shortcut to GrepBuffer
command! -nargs=1 Gb :GrepBuffer <args>
" Search word under the cursor
nnoremap ,gb :<C-u>GrepBuffer<Space><C-r><C-w><Enter>

" ============================================
" Tab completion
" ============================================
" {{{ Autocompletion using the TAB key
" This function determines, wether we are on the start of the line text (then tab indents) or
" if we want to try autocompletion
function! InsertTabWrapper()
        let col = col('.') - 1
        if !col || getline('.')[col - 1] !~ '\k'
                return "\<TAB>"
        else
                if pumvisible()
                        return "\<C-N>"
                else
                        return "\<C-N>\<C-P>"
                end
        endif
endfunction
" Remap the tab key to select action with InsertTabWrapper
inoremap <tab> <c-r>=InsertTabWrapper()<cr>
" }}} Autocompletion using the TAB key

" ============================================
" manpage view
"=============================================
let g:manpageview_winopen="vsplit"

"=============================================
" ref.vim
"=============================================
let g:ref_open = 'vsplit'
let g:ref_perldoc_complete_head = 1
let g:ref_pydoc_complete_head = 1
let g:ref_use_vimproc = 0
let g:ref_jquery_use_cache = 1
let g:ref_phpmanual_path = $HOME.'/.vim/manual/php-chunked-xhtml'
let g:ref_alc_use_cache = 1
nnoremap <C-f><C-f> :<C-u>Ref<Space>
nnoremap <C-f><C-p> :<C-u>Ref perldoc<Space>
nnoremap <C-f><C-y> :<C-u>Ref pydoc<Space>
nnoremap <C-f><C-h> :<C-u>Ref phpmanual<Space>
nnoremap <C-f><C-r> :<C-u>Ref refe<Space>
nnoremap <C-f><C-j> :<C-u>Ref jquery<Space>
nnoremap <C-f><C-a> :<C-u>Ref alc<Space>

if v:version >= 702
  " ============================================
  " fuzzyfinder
  " ============================================
  nnoremap <unique> <silent> <C-l> :FufBuffer!<CR>
  nnoremap <unique> <silent> ef :FufFile!<CR>
  nnoremap <silent> efb :FufBuffer!<CR>
  nnoremap <silent> eff :FufFile!<CR>
  nnoremap <silent> efm :FufMruFile!<CR>
  autocmd FileType fuf nmap <C-c> <ESC>
  let g:fuf_patternSeparator = ' '
  let g:fuf_modesDisable = ['mrucmd']
  let g:fuf_mrufile_exclude = '\v\~$|\.bak$|\.swp|\.howm$'
  let g:fuf_mrufile_maxItem = 2000
  let g:fuf_enumeratingLimit = 20

  "=============================================
  " NeoCompleCache.vim
  "=============================================
  let g:neocomplcache_enable_at_startup = 1 
  let g:neocomplcache_enable_auto_select = 1 

  " snippets
  let g:NeoComplCache_SnippetsDir = '~/.vim/snippets'

  " Use smartcase.
  let g:neocomplcache_enable_ignore_case = 0
  let g:neocomplcache_enable_smart_case = 1
  " Use camel case completion.
  let g:neocomplcache_enable_camel_case_completion = 1
  " Use underbar completion.
  let g:neocomplcache_enable_underbar_completion = 1
  " Set minimum syntax keyword length.
  let g:neocomplcache_min_syntax_length = 3 
  let g:neocomplcache_enable_quick_match = 1
  let g:neocomplcache_enable_wildcard = 1

  nnoremap <silent> nct :NeoComplCacheCachingTags<CR>

  imap <expr><TAB> neocomplcache#sources#snippets_complete#expandable() ? "\<Plug>(neocomplcache_snippets_expand)" : pumvisible() ? "\<C-n>" : "\<TAB>" 
  " <CR>: close popup and save indent.
  " inoremap <expr><CR>  neocomplcache#smart_close_popup() . (&indentexpr != '' " ? "\<C-f>\<CR>X\<BS>":"\<CR>")
  " <TAB>: completion.
  inoremap <expr><TAB>  pumvisible() ? "\<C-n>" : "\<TAB>"
  " <C-h>, <BS>: close popup and delete backword char.
  inoremap <expr><C-h> neocomplcache#smart_close_popup()."\<C-h>"
  inoremap <expr><BS> neocomplcache#smart_close_popup()."\<C-h>"
  inoremap <expr><C-y>  neocomplcache#close_popup()
  inoremap <expr><C-e>  neocomplcache#cancel_popup() 
  imap <C-k> <Plug>(neocomplcache_snippets_expand)
  smap <C-k> <Plug>(neocomplcache_snippets_expand)
  inoremap <expr><C-g> neocomplcache#undo_completion()
  inoremap <expr><C-l> neocomplcache#complete_common_string()
  imap <expr><TAB> neocomplcache#sources#snippets_complete#expandable() ? "\<Plug>(neocomplcache_snippets_expand)" : pumvisible() ? "\<C-n>" : "\<TAB>"


  "=============================================
  " unite.vim
  "=============================================
  let g:unite_enable_start_insert = 1
  let g:unite_update_time = 80
  let g:unite_source_file_ignore_pattern = '\%(^\|/\)\.$\|\~$\|\.\%(o|exe|dll|bak|sw[po]\)$\|blib/'
  nnoremap <silent> <C-f> :<C-u>:UniteWithBufferDir -buffer-name=files buffer file file_mru bookmark tag<CR>
  inoremap <silent> <C-f> <ESC>:<C-u>UniteWithBufferDir -buffer-name=files buffer file file_mru bookmark tag<CR>
  nnoremap <silent> ,ub :<C-u>Unite buffer<CR>
  nnoremap <silent> ,uf :<C-u>UniteWithBufferDir -buffer-name=files file<CR>

  autocmd FileType unite call s:unite_my_settings()
  function! s:unite_my_settings()
    nmap <silent><buffer> <ESC><ESC> q
    imap <silent><buffer> <ESC><ESC> <ESC>q
  endfunction

  "=============================================
  " quickrun
  "=============================================
  augroup QuickRunUnitTest
    autocmd!
    autocmd BufWinEnter,BufNewFile *test.php set filetype=php.unit
    autocmd BufWinEnter,BufNewFile test_*.py set filetype=python.unit
    autocmd BufWinEnter,BufNewFile *.t set filetype=perl.unit
    autocmd BufWinEnter,BufNewFile *_spec.rb set filetype=ruby.rspec
  augroup END
  let g:quickrun_config = {}
  let g:quickrun_config['php.unit'] = {'command': 'phpunitrunner'}
  let g:quickrun_config['python.unit'] = {'command': 'nosetests', 'cmdopt': '-s -vv'}
  let g:quickrun_config['perl.unit'] = {'command': 'prove'}
  let g:quickrun_config['ruby.rspec'] = {'command': 'spec'}

  " ============================================
  " smartword.vim 
  " ============================================
  map w  <Plug>(smartword-w)
  map b  <Plug>(smartword-b)
  map e  <Plug>(smartword-e)
  map ge <Plug>(smartword-ge)

endif
